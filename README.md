# Система учёта (курсовой проект)

Веб-ориентированная информационная система для автоматизации учёта и управления операционной деятельностью сети магазинов канцтоваров.

---

## Для пользователя магазина (запуск без программирования)

**Терминал открывать не нужно.** После того как программу один раз установил специалист (Python, PostgreSQL, настройка БД), вы запускаете её **одним двойным щелчком**:

1. **Из папки проекта:** дважды щёлкните по файлу **«Система учёта — Запуск»** (файл с расширением .vbs).
2. **С рабочего стола:** один раз запустите **«Создать ярлык на рабочем столе»** — на рабочем столе появится ярлык «Система учёта». Дальше просто дважды щёлкните по нему.

После запуска **браузер откроется сам** с окном входа в систему. Окно с чёрным фоном (сервер) можно свернуть — оно должно оставаться запущенным, пока вы работаете. Чтобы полностью выключить программу: закройте это окно или запустите **«Остановить сервер»** в папке проекта.

- **Логин администратора:** admin  
- **Пароль:** admin123  

---

## Требования

- Python 3.8+
- PostgreSQL (база `kursach1`)
- Установленные пакеты: `pip install -r requirements.txt`

## Подключение к БД

Параметры по умолчанию заданы в `database.py`:

- `dbname`: kursach1  
- `user`: postgres  
- `password`: 12345  
- `host`: localhost  
- `port`: 5432  

Их можно переопределить переменными окружения: `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_HOST`, `DB_PORT`.

## Создание схемы БД

Если таблиц ещё нет, выполните в PostgreSQL:

- **Windows:** запустите `run_init_db.bat`
- **Вручную:** `psql -U postgres -d kursach1 -f init_db.sql`

Либо выполните содержимое файла `init_db.sql` вручную в клиенте БД.

## Запуск

```bash
python app.py
```

Приложение будет доступно по адресу: http://localhost:5000

При первом запуске создаётся учётная запись администратора:

- **Логин:** admin  
- **Пароль:** admin123  

## Роли

- **Администратор** — полный доступ: магазины, склады, распределение товара, товары, сотрудники, продажи, отчёты. Уведомления о низких остатках (< 5 ед.).
- **Продавец** — привязан к одному магазину: главная (информация о смене), оформление продаж. Смена открывается при первом входе, автоматически закрывается через 12 часов.

---

## Как перенести и запустить на другом устройстве (сборка веб-приложения)

Веб-приложение — это **не один .exe файл**. Оно состоит из:
- **сервера** (Python + Flask), который слушает порт (например 5000);
- **браузера**, в котором открывают адрес http://localhost:5000.

То есть на новом компьютере нужно: установить окружение, поднять БД, запустить сервер, после чего заходить в программу через браузер.

### Шаг 1. Что скопировать

Скопируйте на новое устройство **всю папку проекта** (где лежат `app.py`, `routes/`, `templates/`, `static/`, `init_db.sql`, `requirements.txt`, `config.py`, `auth_util.py`, `database.py` и т.д.). Файл `schema.sql` не обязателен — для создания таблиц используется `init_db.sql`.

### Шаг 2. Установить на новом устройстве

1. **Python 3.8 или новее**  
   Скачать с https://www.python.org/downloads/ , при установке включить опцию «Add Python to PATH».

2. **PostgreSQL**  
   Установить сервер БД (https://www.postgresql.org/download/ ). Запомнить пароль пользователя `postgres`.

3. **Зависимости проекта**  
   В папке проекта открыть терминал (CMD или PowerShell) и выполнить:
   ```bash
   pip install -r requirements.txt
   ```

### Шаг 3. Создать базу данных

1. Создать базу `kursach1` (или другое имя и указать его в `.env`).
2. Выполнить скрипт создания таблиц:
   - **Windows:** запустить `run_init_db.bat`
   - **Linux/Mac:** `chmod +x run_init_db.sh` и затем `./run_init_db.sh`
   - Либо вручную: `psql -U postgres -d kursach1 -f init_db.sql`

### Шаг 4. Настроить подключение к БД (если нужно)

Если логин/пароль или имя БД на новом ПК другие — в папке проекта создать файл `.env`:

```
DB_NAME=kursach1
DB_USER=postgres
DB_PASSWORD=ваш_пароль
DB_HOST=localhost
DB_PORT=5432
```

Параметры по умолчанию заданы в `database.py`, если `.env` нет.

### Шаг 5. Запустить приложение

**Рекомендуемый способ (для пользователя магазина):** дважды щёлкните по файлу **«Система учёта — Запуск.vbs»** в папке проекта. Браузер откроется автоматически, терминал открывать не нужно. Окно сервера появится свёрнутым в панели задач.

**Через терминал (для разработки):**

```bash
python app.py
```

В консоли появится сообщение о запуске сервера. Приложение само откроет браузер по адресу **http://127.0.0.1:5000**.

- Логин администратора: **admin**
- Пароль: **admin123** (учётка создаётся при первом обращении к приложению, если её ещё нет в БД).

**Остановка:** закройте окно сервера (или окно с run_app.bat) или запустите **«Остановить сервер.bat»**.

---

### Ярлык на рабочем столе

Чтобы запускать программу с рабочего стола одним кликом: один раз запустите **«Создать ярлык на рабочем столе.vbs»**. На рабочем столе появится ярлык «Система учёта» — дважды щёлкните по нему для запуска (браузер откроется сам).
